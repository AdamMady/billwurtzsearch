<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Bill Wurtz Question Search</title>
  <meta charset="UTF-8">
  <meta name="description" content="Search every question & answer from BillWurtz.com">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ——— base colours from original page ——— */
    dco{color:#E9EC54;} rco{color:#ff6600;} qco{color:#B387FF;}
    green{color:#00cc00;} blue{color:#5555ff;} white{color:#000;}
    lightred{color:#ff6666;} strike{text-decoration:line-through;}
    red{color:#ff4444;} yellow{color:#ffff00;} lightgreen{color:#b3ffb3;}

    body{
      background:#323232;
      color:#fff;
      margin:0;
      padding:20px;
      word-wrap:break-word;
      font-family:Arial,Helvetica,sans-serif;   /* closer to original */
    }
    h1{font-weight:400;margin-top:0;}
    a{color:#00FF00;} a:visited{color:#67FF79;}

    #search-bar{
      width:100%;padding:12px;font-size:1.1em;border:1px solid #555;
      background:#222;color:#fff;border-radius:4px;box-sizing:border-box;
      margin-bottom:1em;
    }
    #results-info{margin:1em 0;font-style:italic;color:#ccc}
    #loading{display:none;font-style:italic;color:#ccc;margin:1em 0}
    mark{background:#E9EC54;color:#000;padding:1px 2px;border-radius:2px}
    .question{margin-bottom:2em}
  </style>
</head>
<body bgcolor="#323232" text="white" link="#00FF00" vlink="#67FF79">
  <h1>
    Se<font color="#00EE3B">a</font>rch Bill W<font color="#00EE3B">u</font>rtz Qu<font color="#00EE3B">e</font>stions
  </h1>

  <input type="search" id="search-bar" placeholder="search through space and time..." autofocus>
  <div id="results-info">Loading archive…</div>
  <div id="results"></div>
  <div id="loading">Loading more…</div>

<script>
const DATA_BASE = 'https://adammady.github.io/billwurtzsearch/data/';
let manifest=[],allQs=[],idx=0,loading=false,searching=false,allLoaded=false;

const bar  = document.getElementById('search-bar');
const info = document.getElementById('results-info');
const res  = document.getElementById('results');
const load = document.getElementById('loading');

function debounce(fn,d=300){let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),d)};}

function render(list,q=''){
  const frag=document.createDocumentFragment();
  list.forEach(it=>{
    const div=document.createElement('div');
    div.className='question';
    let html=it.html;
    if(q){
      const re=new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'gi');
      html=html.replace(re,m=>`<mark>${m}</mark>`);
    }
    div.innerHTML=html;
    frag.appendChild(div);
  });
  res.appendChild(frag);
}

async function loadNext(){
  if(loading||idx>=manifest.length){if(idx>=manifest.length)info.textContent=`All ${allQs.length} loaded.`;return;}
  loading=true;load.style.display='block';
  const name=manifest[idx];
  try{
    const data=await fetch(DATA_BASE+name).then(r=>r.json());
    allQs.push(...data);render(data);
    idx++;info.textContent=`Showing ${allQs.length}`;
  }catch(e){info.textContent='Load error';console.error(e);}
  loading=false;load.style.display='none';
}

async function loadAll(){
  if(allLoaded)return;loading=true;info.textContent='Loading all…';
  const rem=manifest.slice(idx);
  const arr=await Promise.all(rem.map(f=>fetch(DATA_BASE+f).then(r=>r.json())));
  arr.forEach(c=>allQs.push(...c));allLoaded=true;idx=manifest.length;
  loading=false;info.textContent=`All ${allQs.length} loaded.`;
}

const search=debounce(async ()=>{
  const q=bar.value.trim().toLowerCase();
  if(!q){searching=false;res.innerHTML='';render(allQs.slice(0,idx?allQs.length:0));info.textContent=`Showing ${allQs.length}`;return;}
  searching=true;if(!allLoaded)await loadAll();
  const t0=performance.now();
  const out=allQs.filter(it=>{
    if(!it.plain)it.plain=it.html.replace(/<[^>]*>/g,'').toLowerCase();
    return it.plain.includes(q);
  });
  const t1=performance.now();
  res.innerHTML='';render(out,q);
  info.textContent=`${out.length} found in ${Math.round(t1-t0)} ms.`;
},300);

window.addEventListener('scroll',()=>{if(searching||loading)return;
  if(window.innerHeight+window.scrollY>=document.body.offsetHeight-500)loadNext();});

(async()=>{
  try{
    const m=await fetch(DATA_BASE+'manifest.json').then(r=>r.json());
    manifest=m.files;await loadNext();
  }catch(e){info.textContent='Manifest load error';console.error(e);}
  bar.addEventListener('input',search);
})();
</script>
</body>
</html>
